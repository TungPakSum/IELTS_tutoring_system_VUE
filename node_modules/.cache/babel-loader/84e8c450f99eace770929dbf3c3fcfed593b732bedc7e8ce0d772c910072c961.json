{"ast":null,"code":"import _regeneratorRuntime from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport { ref, onMounted, computed } from 'vue';\nimport { useRoute } from 'vue-router';\nexport default {\n  name: 'VolunteersCard',\n  setup: function setup() {\n    var lastPage = ref(0);\n    var perPage = ref(6);\n    var router = useRoute();\n    var eid = ref();\n    var sid = ref();\n    var currentFirstPage = ref(1);\n    var currentLastPage = ref(3);\n    var items = ref([]);\n    var flagbagitems = ref([]);\n    onMounted(function () {\n      fetchPage(1);\n      getIds();\n      currentFirstPage.value = 0;\n      currentLastPage.value = 3;\n    });\n    var pages = computed(function () {\n      var pages = [];\n      for (var i = 1; i <= lastPage.value; i++) {\n        pages.push(i);\n      }\n      return pages;\n    });\n    var deleteVolunteers = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(id) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"/api/volunteers/delete/\".concat(id), {\n                method: \"delete\",\n                body: JSON.stringify(items.value)\n              });\n            case 2:\n              response = _context.sent;\n              if (response.ok) {\n                alert(\"Flagbag deleted\");\n                location.assign(\"/events/\" + eid.value + \"/stations/\" + sid.value + \"/volunteers\");\n              } else {\n                alert(response.statusText);\n              }\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function deleteVolunteers(_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    var fetchPage = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(page) {\n        var response, data;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"/api/volunteers/get?perPage=\".concat(perPage.value, \"&page=\").concat(page));\n            case 2:\n              response = _context2.sent;\n              if (!response.ok) {\n                _context2.next = 12;\n                break;\n              }\n              _context2.next = 6;\n              return response.json();\n            case 6:\n              data = _context2.sent;\n              items.value = data.items;\n              lastPage.value = data.pages;\n              console.log(data.items);\n              _context2.next = 13;\n              break;\n            case 12:\n              alert(response.statusText);\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function fetchPage(_x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    var getBid = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(vid) {\n        var response, data, bid;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return fetch(\"/api/bags?vid=\".concat(vid));\n            case 2:\n              response = _context3.sent;\n              if (!response.ok) {\n                _context3.next = 9;\n                break;\n              }\n              _context3.next = 6;\n              return response.json();\n            case 6:\n              data = _context3.sent;\n              bid = data.items._id;\n              return _context3.abrupt(\"return\", bid);\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      return function getBid(_x3) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    var getIds = function getIds() {\n      eid.value = router.params.eid;\n      sid.value = router.params.sid;\n    };\n    var nextPage = function nextPage(currentPage) {\n      fetchPage(currentPage);\n      currentFirstPage.value += 3;\n      currentLastPage.value += 3;\n    };\n    return {\n      eid: eid,\n      sid: sid,\n      items: items,\n      pages: pages,\n      currentFirstPage: currentFirstPage,\n      currentLastPage: currentLastPage,\n      fetchPage: fetchPage,\n      nextPage: nextPage,\n      deleteVolunteers: deleteVolunteers\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","useRoute","name","setup","lastPage","perPage","router","eid","sid","currentFirstPage","currentLastPage","items","flagbagitems","fetchPage","getIds","value","pages","i","push","deleteVolunteers","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","id","response","wrap","_callee$","_context","prev","next","fetch","concat","method","body","JSON","stringify","sent","ok","alert","location","assign","statusText","stop","_x","apply","arguments","_ref2","_callee2","page","data","_callee2$","_context2","json","console","log","_x2","getBid","_ref3","_callee3","vid","bid","_callee3$","_context3","_id","abrupt","_x3","params","nextPage","currentPage"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/VolunteersCard.vue"],"sourcesContent":["<template>\n  <div class=\"card-group row\">\n    <div\n      v-for=\"item in items\" \n      :key=\"item\" \n      class=\"col-sm-4\"\n    >\n      <div class=\"card\">\n        <div class=\"card-body\">\n          <QrCode :data=\"item\"></QrCode>\n          <h5 class=\"card-title\">\n            {{ item.username }}\n          </h5>\n          <ul class=\"list-group list-group-flush\">\n            <li class=\"list-group-item h5 fw-bold\"\n            :class=\"{'text-success': item.type.type === 'individual',\n                      'text-primary': item.type.type === 'group'}\">\n              {{ item.type.name }}\n            </li>\n\n            <li class=\"list-group-item\">\n              聯絡電話: {{ item.phoneNumber }}\n            </li>\n            <li class=\"list-group-item\">\n              聯絡電郵: {{ item.email }}\n            </li>\n            \n            <li class=\"list-group-item\">\n              賣旗地點: {{ item.serviceLocation }}\n            </li>\n          </ul>\n          <div class=\"card-body\">\n            <router-link\n              v-if = \"item.type.type !== 'individual'\"\n              v-slot=\"{ navigate }\"\n              :to=\"`/events/${eid}/stations/${sid}/volunteers/${item._id}/flagbags`\"\n              custom\n            >\n              <a\n                href=\"#\"\n                class=\"btn btn-success\"\n                @click=\"navigate\"\n              >旗袋</a>\n            </router-link>\n            <router-link\n              v-slot=\"{ navigate }\"\n              :to=\"`/events/${eid}/stations/${sid}/volunteers/${item._id}`\"\n              custom\n            >\n              <a\n                href=\"#\"\n                class=\"btn btn-success\"\n                @click=\"navigate\"\n              >編緝</a>\n            </router-link>\n            <a\n            href=\"#\"\n            class=\"btn btn-danger\"\n            @click=\"deleteVolunteers(item._id)\"\n            >刪除</a>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"pagination-group row\">\n    <nav aria-label=\"Page navigation example\">\n      <ul class=\"pagination\">\n        <li class=\"page-item\">\n          <a\n            class=\"page-link\"\n            href=\"#\"\n            aria-label=\"Previous\"\n          >\n            <span aria-hidden=\"true\">&laquo;</span>\n          </a>\n        </li>\n        <li\n          v-for=\"i in pages.slice(currentFirstPage, currentLastPage)\"\n          :key=\"i\"\n          class=\"page-item\"\n        >\n          <a\n            class=\"page-link\"\n            @click=\"fetchPage(i)\"\n          >{{ i }}</a>\n        </li>\n        <li\n          class=\" page-item\"\n          @click=\"nextPage(i)\"\n        >\n          <a\n            class=\"page-link\"\n            aria-label=\"Next\"\n          >\n            <span aria-hidden=\"false\">&raquo;</span>\n          </a>\n        </li>\n      </ul>\n    </nav>\n  </div>\n</template>\n\n<script>\nimport {ref, onMounted, computed} from 'vue'\nimport {useRoute} from 'vue-router';\n\n\nexport default {\n  name: 'VolunteersCard',\n  \n  setup: function () {\n    const lastPage = ref(0)\n    const perPage = ref(6);\n    const router = useRoute();\n    const eid = ref();\n    const sid = ref();\n    let currentFirstPage = ref(1);\n    let currentLastPage = ref(3);\n    let items = ref([]);\n    let flagbagitems = ref([]);\n\n\n    onMounted(function () {\n      fetchPage(1);\n      getIds();\n      currentFirstPage.value = 0;\n      currentLastPage.value = 3;\n    });\n\n    const pages = computed(() => {\n      let pages = [];\n      for (let i = 1; i <= lastPage.value; i++) {\n        pages.push(i)\n      }\n      return pages;\n    })\n\n    const deleteVolunteers = async function (id) {\n      const response = await fetch(`/api/volunteers/delete/${id}`, {\n        method: \"delete\",\n        body: JSON.stringify(items.value),\n      });\n      if (response.ok) {\n        alert(\"Flagbag deleted\");\n        location.assign(\"/events/\" + eid.value + \"/stations/\" + sid.value + \"/volunteers\");\n      } else {\n        alert(response.statusText);\n      }\n    };\n\n    const fetchPage = async function (page) {\n      const response = await fetch(`/api/volunteers/get?perPage=${perPage.value}&page=${page}`);\n      if (response.ok) {\n        let data = await response.json()\n        items.value = data.items\n        lastPage.value = data.pages\n        console.log(data.items)\n      } else {\n        alert(response.statusText)\n      }\n    }\n\n    const getBid = async function(vid)\n    {\n        // Retrieve the corresponding bag object based on the volunteer's object ID\n        const response = await fetch(`/api/bags?vid=${vid}`);\n        if(response.ok)\n        {\n          let data = await response.json()\n          const bid = data.items._id\n          return bid;\n        }\n\n        // Pass the volunteer object and the corresponding bag object ID to the QRcode component\n        \n    }\n\n    const getIds = function () {\n      eid.value = router.params.eid;\n      sid.value = router.params.sid;\n    }\n\n    const nextPage = (currentPage) => {\n      fetchPage(currentPage);\n      currentFirstPage.value += 3;\n      currentLastPage.value += 3;\n    };\n\n    return {\n      eid,\n      sid,\n      items,\n      pages,\n      currentFirstPage,\n      currentLastPage,\n      fetchPage,\n      nextPage,\n      deleteVolunteers\n    };\n  },\n};\n</script>\n<style scoped>\n.pagination-group {\n  margin-top: 20px;\n}\n\n.card {\n  margin-bottom: 10px;\n}\n\n.btn {\n  margin-right: 10px;\n  margin-bottom: 10px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}