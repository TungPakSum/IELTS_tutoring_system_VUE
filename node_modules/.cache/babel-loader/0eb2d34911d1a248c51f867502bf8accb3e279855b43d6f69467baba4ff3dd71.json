{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport { vModelText as _vModelText, createElementVNode as _createElementVNode, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-58ba621f\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = {\n  \"class\": \"row\"\n};\nvar _hoisted_2 = {\n  \"class\": \"col-12 p-3 searchBox\"\n};\nvar _hoisted_3 = {\n  \"class\": \"card-group row\"\n};\nvar _hoisted_4 = {\n  \"class\": \"card\"\n};\nvar _hoisted_5 = {\n  \"class\": \"card-body\"\n};\nvar _hoisted_6 = {\n  \"class\": \"card-title\"\n};\nvar _hoisted_7 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"h6\", {\n    \"class\": \"card-subtitle mb-2 text-muted\"\n  }, \" 地址: \", -1 /* HOISTED */);\n});\nvar _hoisted_8 = {\n  \"class\": \"card-text\"\n};\nvar _hoisted_9 = {\n  \"class\": \"list-group list-group-flush\"\n};\nvar _hoisted_10 = {\n  \"class\": \"list-group-item\"\n};\nvar _hoisted_11 = {\n  \"class\": \"list-group-item\"\n};\nvar _hoisted_12 = {\n  \"class\": \"list-group-item\"\n};\nvar _hoisted_13 = {\n  \"class\": \"card-body\"\n};\nvar _hoisted_14 = [\"onClick\"];\nvar _hoisted_15 = [\"onClick\"];\nvar _hoisted_16 = [\"onClick\"];\nvar _hoisted_17 = {\n  key: 0,\n  \"class\": \"pagination-group row\"\n};\nvar _hoisted_18 = {\n  \"aria-label\": \"Page navigation example\"\n};\nvar _hoisted_19 = {\n  \"class\": \"pagination\"\n};\nvar _hoisted_20 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"li\", {\n    \"class\": \"page-item\"\n  }, [/*#__PURE__*/_createElementVNode(\"a\", {\n    \"class\": \"page-link\",\n    href: \"#\",\n    \"aria-label\": \"Previous\"\n  }, [/*#__PURE__*/_createElementVNode(\"span\", {\n    \"aria-hidden\": \"true\"\n  }, \"«\")])], -1 /* HOISTED */);\n});\nvar _hoisted_21 = [\"onClick\"];\nvar _hoisted_22 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"a\", {\n    \"class\": \"page-link\",\n    \"aria-label\": \"Next\"\n  }, [/*#__PURE__*/_createElementVNode(\"span\", {\n    \"aria-hidden\": \"false\"\n  }, \"»\")], -1 /* HOISTED */);\n});\nvar _hoisted_23 = [_hoisted_22];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_withDirectives(_createElementVNode(\"input\", {\n    id: \"form1\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return _ctx.Search = $event;\n    }),\n    type: \"search\",\n    \"class\": \"form-control\",\n    placeholder: \"Search\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, _ctx.Search]])])]), _createElementVNode(\"div\", _hoisted_3, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.items, function (item) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: item,\n      \"class\": \"col-sm-4 card-item\"\n    }, [_createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"h5\", _hoisted_6, _toDisplayString(item.name), 1 /* TEXT */), _hoisted_7, _createElementVNode(\"p\", _hoisted_8, _toDisplayString(item.address), 1 /* TEXT */)]), _createElementVNode(\"ul\", _hoisted_9, [_createElementVNode(\"li\", _hoisted_10, \" 地區: \" + _toDisplayString(item.district.name), 1 /* TEXT */), _createElementVNode(\"li\", _hoisted_11, \" 已發送旗袋: \" + _toDisplayString(item.flagbag), 1 /* TEXT */), _createElementVNode(\"li\", _hoisted_12, \" 所屬旗站: \" + _toDisplayString(item.subdistrict), 1 /* TEXT */)]), _createElementVNode(\"div\", _hoisted_13, [_createVNode(_component_router_link, {\n      to: \"/events/\".concat(_ctx.eid, \"/stations/\").concat(item._id, \"/volunteers\"),\n      custom: \"\"\n    }, {\n      \"default\": _withCtx(function (_ref) {\n        var navigate = _ref.navigate;\n        return [_createElementVNode(\"a\", {\n          href: \"#\",\n          \"class\": \"btn btn-success\",\n          onClick: navigate\n        }, \"義工\", 8 /* PROPS */, _hoisted_14)];\n      }),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"to\"]), _createVNode(_component_router_link, {\n      to: \"/events/\".concat(_ctx.eid, \"/stations/\").concat(item._id),\n      custom: \"\"\n    }, {\n      \"default\": _withCtx(function (_ref2) {\n        var navigate = _ref2.navigate;\n        return [_createElementVNode(\"a\", {\n          href: \"#\",\n          \"class\": \"btn btn-success\",\n          onClick: navigate\n        }, \"編緝\", 8 /* PROPS */, _hoisted_15)];\n      }),\n      _: 2 /* DYNAMIC */\n    }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"to\"]), _createElementVNode(\"a\", {\n      href: \"#\",\n      \"class\": \"btn btn-danger\",\n      onClick: function onClick($event) {\n        return _ctx.deleteStations(item._id);\n      }\n    }, \"刪除\", 8 /* PROPS */, _hoisted_16)])])]);\n  }), 128 /* KEYED_FRAGMENT */))]), _ctx.pages.length > 1 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_17, [_createElementVNode(\"nav\", _hoisted_18, [_createElementVNode(\"ul\", _hoisted_19, [_hoisted_20, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.pages.slice(_ctx.currentFirstPage, _ctx.currentLastPage), function (i) {\n    return _openBlock(), _createElementBlock(\"li\", {\n      key: i,\n      \"class\": \"page-item\"\n    }, [_createElementVNode(\"a\", {\n      \"class\": \"page-link\",\n      onClick: function onClick($event) {\n        return _ctx.fetchPage(i);\n      }\n    }, _toDisplayString(i), 9 /* TEXT, PROPS */, _hoisted_21)]);\n  }), 128 /* KEYED_FRAGMENT */)), _createElementVNode(\"li\", {\n    \"class\": \"page-item\",\n    onClick: _cache[1] || (_cache[1] = function ($event) {\n      return _ctx.nextPage(_ctx.i);\n    })\n  }, _hoisted_23)])])])) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */);\n}","map":{"version":3,"names":["_createElementVNode","href","_hoisted_22","_hoisted_1","_hoisted_2","id","_ctx","Search","$event","type","placeholder","_hoisted_3","_createElementBlock","_Fragment","_renderList","items","item","key","_hoisted_4","_hoisted_5","_hoisted_6","_toDisplayString","name","_hoisted_7","_hoisted_8","address","_hoisted_9","_hoisted_10","district","_hoisted_11","flagbag","_hoisted_12","subdistrict","_hoisted_13","_createVNode","_component_router_link","to","concat","eid","_id","custom","_ref","navigate","onClick","_hoisted_14","_ref2","_hoisted_15","deleteStations","_hoisted_16","pages","length","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","slice","currentFirstPage","currentLastPage","i","fetchPage","_hoisted_21","_cache","nextPage"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/StationsCard.vue"],"sourcesContent":["<template>\n  <div class=\"row\">\n    <div class=\"col-12 p-3 searchBox\">\n      <input\n        id=\"form1\"\n        v-model=\"Search\"\n        type=\"search\"\n        class=\"form-control\"\n        placeholder=\"Search\"\n      >\n    </div>\n  </div>\n  <div class=\"card-group row\">\n    <div\n      v-for=\"item in items\"\n      :key=\"item\"\n      class=\"col-sm-4 card-item\"\n    >\n      <div class=\"card\">\n        <div class=\"card-body\">\n          <h5 class=\"card-title\">\n            {{ item.name }}\n          </h5>\n          <h6 class=\"card-subtitle mb-2 text-muted\">\n            地址:\n          </h6>\n          <p class=\"card-text\">\n            {{ item.address }}\n          </p>\n        </div>\n        <ul class=\"list-group list-group-flush\">\n          <li class=\"list-group-item\">\n            地區: {{ item.district.name }}\n          </li>\n          <li class=\"list-group-item\">\n            已發送旗袋: {{ item.flagbag }}\n          </li>\n          <li class=\"list-group-item\">\n            所屬旗站: {{ item.subdistrict }}\n          </li>\n        </ul>\n        <div class=\"card-body\">\n          <router-link\n            v-slot=\"{ navigate }\"\n            :to=\"`/events/${eid}/stations/${item._id}/volunteers`\"\n            custom\n          >\n            <a\n              href=\"#\"\n              class=\"btn btn-success\"\n              @click=\"navigate\"\n            >義工</a>\n          </router-link>\n          <router-link\n            v-slot=\"{ navigate }\"\n            :to=\"`/events/${eid}/stations/${item._id}`\"\n            custom\n          >\n            <a\n              href=\"#\"\n              class=\"btn btn-success\"\n              @click=\"navigate\"\n            >編緝</a>\n          </router-link>\n          <a\n            href=\"#\"\n            class=\"btn btn-danger\"\n            @click=\"deleteStations(item._id)\"\n          >刪除</a>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class=\"pagination-group row\" v-if=\"pages.length > 1\">\n    <nav aria-label=\"Page navigation example\">\n      <ul class=\"pagination\">\n        <li class=\"page-item\">\n          <a\n            class=\"page-link\"\n            href=\"#\"\n            aria-label=\"Previous\"\n          >\n\n            <span aria-hidden=\"true\">&laquo;</span>\n          </a>\n        </li>\n        <li\n          v-for=\"i in pages.slice(currentFirstPage, currentLastPage)\"\n          :key=\"i\"\n          class=\"page-item\"\n        >\n          <a\n            class=\"page-link\"\n            @click=\"fetchPage(i)\"\n          >{{ i }}</a>\n        </li>\n        <li\n          class=\"page-item\"\n          @click=\"nextPage(i)\"\n        >\n          <a\n            class=\"page-link\"\n            aria-label=\"Next\"\n          >\n            <span aria-hidden=\"false\">&raquo;</span>\n          </a>\n        </li>\n      </ul>\n    </nav>\n  </div>\n</template>\n\n<script>\nimport {computed, onMounted, ref, watch} from \"vue\";\nimport {useRoute} from \"vue-router\";\n\nexport default {\n    name: \"EventsCard\",\n    setup: function () {\n        const lastPage = ref(0);\n        const perPage = ref(6);\n        const router = useRoute();\n        let currentFirstPage = ref(1);\n        let currentLastPage = ref(3);\n        let currentPage = ref();\n        let items = ref([]);\n        let itemsWithoutPages = ref([]);\n        let Search = ref();\n        let eid = ref();\n\n        onMounted(function () {\n            fetchPage(1);\n            getEid();\n            currentFirstPage.value = 0;\n            currentLastPage.value = 3;\n        });\n\n        watch(Search, () => {\n            //make the searchbox response immedidately whenever the input detect changes\n            filterItems(Search.value);\n            currentFirstPage.value = 0;\n            currentLastPage.value = 3;\n        });\n\n        const pages = computed(() => {\n            let pages = [];\n            for (let i = 1; i <= lastPage.value; i++) {\n                pages.push(i);\n            }\n            return pages;\n        });\n\n        const getEid = function () {\n            eid.value = router.params.eid;\n        };\n\n        const fetchPage = async function (page) {\n            //const response = await fetch(\n            //  `/api/${props.route}/get?perPage=${perPage.value}&page=${page}`\n            //);\n            currentPage.value = page;\n            const response = await fetch(\n                `/api/stations/get?perPage=${perPage.value}&page=${page}`\n            );\n            if (response.ok) {\n                let data = await response.json();\n                items.value = data.items;\n                itemsWithoutPages.value = data.itemsWithoutPages;\n                lastPage.value = data.pages;\n            } else {\n                alert(response.statusText);\n            }\n        };\n\n        const deleteStations = async function (id) {\n            const response = await fetch(`/api/stations/delete/${id}`, {\n                method: \"delete\",\n                body: JSON.stringify(items.value),\n            });\n            if (response.ok) {\n                alert(\"Stations deleted\");\n                getEid();\n                location.assign(\"/events/\" + eid.value + \"/stations\");\n                //location.assign(\"/users\");\n            } else {\n                alert(response.statusText);\n            }\n        };\n\n        const nextPage = (currentPage) => {\n            fetchPage(currentPage);\n            currentFirstPage.value += 3;\n            currentLastPage.value += 3;\n        };\n\n\n        // filter the item according to the searchbox input,\n        // this only activate when the input of the searchbox detect changes\n        const filterItems = async function (searchText) {\n            //if searchText is not empty, do the filtering, else nothing change\n            if (searchText) {\n                const searchTextLower = searchText.replaceAll(' ', '').toLowerCase();\n                //console.log(searchTextLower);\n                //console.log('Before: ', items.value)\n                const filteredItems = itemsWithoutPages.value.filter(item => {\n                    return item['name'].replaceAll(' ', '').toLowerCase().includes(searchTextLower) ||\n                        item.district.district.replaceAll(' ', '').toLowerCase().includes(searchTextLower);\n                });\n                items.value = filteredItems;\n                lastPage.value = items.value.length / perPage.value;\n                //console.log('After: ',items.value)\n            } else if (searchText === '') {\n                console.log(currentPage);\n                await fetchPage(currentPage.value);\n            }\n        }\n\n        return {\n            eid,\n            items,\n            Search,\n            pages,\n            currentFirstPage,\n            currentLastPage,\n            fetchPage,\n            nextPage,\n            deleteStations,\n            filterItems,\n            currentPage\n        };\n    },\n}\n</script>\n\n<style scoped>\n.pagination-group {\n    margin-top: 20px;\n}\n\n.card {\n    margin-bottom: 10px;\n}\n\n.btn {\n    margin-right: 10px;\n    margin-bottom: 10px;\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}