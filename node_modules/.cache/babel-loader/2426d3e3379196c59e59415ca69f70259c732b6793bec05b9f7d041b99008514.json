{"ast":null,"code":"import _regeneratorRuntime from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport { ref, onMounted } from \"vue\";\nimport JwtDecode from \"jwt-decode\";\nexport default {\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: 'Login',\n  setup: function setup() {\n    var credential = ref({});\n    onMounted(function () {\n      if (localStorage.getItem(\"token\") !== null) window.location.assign('/events');\n    });\n    var login = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, data, user, _data, eid, i;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"/api/users/login\", {\n                method: \"post\",\n                headers: {\n                  \"content-type\": \"application/json\"\n                },\n                body: JSON.stringify(credential.value)\n              });\n            case 2:\n              response = _context.sent;\n              if (!response.ok) {\n                _context.next = 25;\n                break;\n              }\n              _context.next = 6;\n              return response.json();\n            case 6:\n              data = _context.sent;\n              user = data;\n              try {\n                localStorage.setItem(\"token\", data.token);\n              } catch (error) {\n                console.log(error);\n              }\n              alert(\"Login Successfully.\");\n              //  Decode token\n              user = JwtDecode(localStorage.getItem(\"token\"));\n              if (!(user.role === 'admin')) {\n                _context.next = 15;\n                break;\n              }\n              window.location.assign('/events');\n              _context.next = 23;\n              break;\n            case 15:\n              if (!(user.role === 'stationManager')) {\n                _context.next = 23;\n                break;\n              }\n              _context.next = 18;\n              return fetchStation();\n            case 18:\n              _data = _context.sent;\n              eid = \"\";\n              for (i = 0; i < _data.itemsWithoutPages.length; i++) {\n                eid = _data.itemsWithoutPages[i].eid;\n              }\n              console.log(eid);\n              window.location.assign(\"/events/\".concat(eid, \"/stations/\"));\n            case 23:\n              _context.next = 27;\n              break;\n            case 25:\n              alert(response.statusText);\n              window.location.assign('/login');\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function login() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    var fetchStation = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var response, data;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"/api/stations/get\", {\n                method: \"get\",\n                headers: {\n                  \"x-access-token\": localStorage.getItem(\"token\"),\n                  \"content-type\": \"application/json\"\n                }\n              });\n            case 2:\n              response = _context2.sent;\n              data = {};\n              if (!response.ok) {\n                _context2.next = 12;\n                break;\n              }\n              _context2.next = 7;\n              return response.json();\n            case 7:\n              data = _context2.sent;\n              console.log(data);\n              return _context2.abrupt(\"return\", data);\n            case 12:\n              alert(response.statusText);\n            case 13:\n              return _context2.abrupt(\"return\", data);\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function fetchStation() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n    return {\n      credential: credential,\n      login: login\n    };\n  }\n};","map":{"version":3,"names":["ref","onMounted","JwtDecode","name","setup","credential","localStorage","getItem","window","location","assign","login","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","data","user","_data","eid","i","wrap","_callee$","_context","prev","next","fetch","method","headers","body","JSON","stringify","value","sent","ok","json","setItem","token","error","console","log","alert","role","fetchStation","itemsWithoutPages","length","concat","statusText","stop","apply","arguments","_ref2","_callee2","_callee2$","_context2","abrupt"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/Login.vue"],"sourcesContent":["<template>\n  <div class=\"Login\">\n    <div class=\"container\">\n      <div class=\"row justify-content-center\">\n        <div class=\"col-sm-6\">\n          <img\n            src=\"./../assets/icon.png\"\n            class=\"img-fluid\"\n            style=\"margin-bottom: 20px;\"\n          >\n          <form @submit.prevent=\"submit\">\n            <legend>登入</legend>\n            <div class=\"mb-3\">\n              <label\n                for=\"exampleFormControlInput1\"\n                class=\"form-label\"\n              >用戶： </label>\n              <input\n                id=\"username\"\n                v-model=\"credential.username\"\n                type=\"text\"\n                class=\"form-control\"\n                placeholder=\"Username\"\n              >\n            </div>\n            <div class=\"mb-3\">\n              <label\n                for=\"exampleFormControlTextarea1\"\n                class=\"form-label\"\n              >密碼： </label>\n              <input\n                id=\"password\"\n                v-model=\"credential.password\"\n                type=\"password\"\n                class=\"form-control\"\n                placeholder=\"Password\"\n              >\n            </div>\n            <button\n              type=\"submit\"\n              class=\"btn btn-primary\"\n              @click=\"login\"\n            >\n              登入\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from \"vue\";\nimport JwtDecode from \"jwt-decode\";\n\nexport default {\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: 'Login',\n  setup() {\n    const credential = ref({});\n\n    onMounted(() => {\n      if (localStorage.getItem(\"token\") !== null)\n        window.location.assign('/events')\n    })\n\n    const login = async function () {\n\n      const response = await fetch(\"/api/users/login\", {\n        method: \"post\",\n        headers: {\n          \"content-type\": \"application/json\"\n        },\n        body: JSON.stringify(credential.value)\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        let user = data;\n        try {\n          localStorage.setItem(\"token\", data.token);\n        } catch (error) {\n          console.log(error)\n        }\n\n        alert(\"Login Successfully.\")\n        //  Decode token\n        user = JwtDecode(localStorage.getItem(\"token\"));\n\n        if (user.role === 'admin') {\n          window.location.assign('/events')\n        } else if (user.role === 'stationManager') {\n          const data = await fetchStation();\n          let eid = \"\";\n          for (let i = 0; i < data.itemsWithoutPages.length; i++) {\n            eid = data.itemsWithoutPages[i].eid;\n          }\n          console.log(eid);\n          window.location.assign(`/events/${eid}/stations/`)\n        }\n      }\n      else {\n        alert(response.statusText)\n        window.location.assign('/login')\n      }\n    }\n\n    const fetchStation = async function () {\n      const response = await fetch(`/api/stations/get`, {\n        method: \"get\",\n        headers: {\n          \"x-access-token\": localStorage.getItem(\"token\"),\n          \"content-type\": \"application/json\"\n        }\n      });\n      let data = {};\n      if (response.ok) {\n        data = await response.json();\n        console.log(data);\n        return data;\n      } else {\n        alert(response.statusText)\n      }\n      return data;\n    }\n\n\n    return {\n      credential,\n      login\n    }\n  }\n}\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}