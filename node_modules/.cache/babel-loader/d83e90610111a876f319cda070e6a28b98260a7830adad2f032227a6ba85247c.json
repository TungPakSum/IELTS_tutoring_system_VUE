{"ast":null,"code":"import _regeneratorRuntime from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport { computed, onMounted, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\nexport default {\n  name: \"UsersForm\",\n  props: {\n    // eslint-disable-next-line vue/require-default-prop\n    usertype: String\n  },\n  setup: function setup(props) {\n    var updateForm = ref(false);\n    var selected = ref(\"\");\n    var path = ref(\"\");\n    var item = ref({});\n    var router = useRoute();\n    var roles = computed(function () {\n      return [{\n        roles: \"admin\",\n        name: \"管理員\"\n      }, {\n        roles: \"stationManager\",\n        name: \"旗長\"\n      }];\n    });\n    onMounted(function () {\n      console.log(router.params.uid);\n\n      // console.log(router.params.uid);\n\n      if (!(router.params.uid === \"create\")) {\n        updateForm.value = true;\n        fetchPage();\n      }\n      getPath();\n    });\n    var fetchPage = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, data;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetch(\"/api/users/get/\".concat(router.params.uid));\n            case 2:\n              response = _context.sent;\n              if (!response.ok) {\n                _context.next = 11;\n                break;\n              }\n              _context.next = 6;\n              return response.json();\n            case 6:\n              data = _context.sent;\n              item.value = data.items;\n              selected.value = item.value.role;\n              console.log(data.items);\n              console.log(item.value);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function fetchPage() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    var getPath = function getPath() {\n      var elements = router.path.split(\"/\");\n      path.value = \"/\" + elements[1];\n      for (var i = 2; i < elements.length - 1; i++) {\n        path.value += \"/\" + elements[i];\n      }\n    };\n\n    // Delete function\n    var deleteUsers = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(id) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return fetch(\"/api/users/get/\".concat(id, \"/confirm/delete\"), {\n                method: \"delete\",\n                body: JSON.stringify(item.value)\n              });\n            case 2:\n              response = _context2.sent;\n              if (response.ok) {\n                alert(\"Users deleted\");\n                location.assign(\"/users\");\n              } else {\n                alert(response.statusText);\n              }\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      return function deleteUsers(_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    // Update function\n    var submit = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(event) {\n        var response, id, _response;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              event.preventDefault();\n              console.log(updateForm.value);\n              if (updateForm.value) {\n                _context3.next = 9;\n                break;\n              }\n              _context3.next = 5;\n              return fetch(\"/api/users/create\", {\n                method: \"post\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(item.value)\n              });\n            case 5:\n              response = _context3.sent;\n              if (response.ok) {\n                alert(\"建立成功\");\n                window.location.replace(path.value);\n              } else {\n                alert(response.statusText);\n              }\n              _context3.next = 17;\n              break;\n            case 9:\n              console.log(item.value);\n              id = item.value._id;\n              delete item.value._id;\n              _context3.next = 14;\n              return fetch(\"/api/users/update/\".concat(id), {\n                method: \"put\",\n                headers: {\n                  \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(item.value)\n              });\n            case 14:\n              _response = _context3.sent;\n              console.log(_response);\n              if (_response.ok) {\n                alert(\"更新成功\");\n                window.location.replace(path.value);\n              } else {\n                alert(_response.statusText);\n              }\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }));\n      return function submit(_x2) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n    return {\n      item: item,\n      roles: roles,\n      updateForm: updateForm,\n      deleteUsers: deleteUsers,\n      submit: submit\n    };\n  }\n};","map":{"version":3,"names":["computed","onMounted","ref","useRoute","name","props","usertype","String","setup","updateForm","selected","path","item","router","roles","console","log","params","uid","value","fetchPage","getPath","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","data","wrap","_callee$","_context","prev","next","fetch","concat","sent","ok","json","items","role","stop","apply","arguments","elements","split","i","length","deleteUsers","_ref2","_callee2","id","_callee2$","_context2","method","body","JSON","stringify","alert","location","assign","statusText","_x","submit","_ref3","_callee3","event","_response","_callee3$","_context3","preventDefault","headers","window","replace","_id","_x2"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/UsersForm.vue"],"sourcesContent":["<template>\n  <form>\n    <div class=\"mb-3\">\n      <legend>用戶資料</legend>\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"username\"\n        class=\"form-label\"\n      >用戶名稱</label>\n      <input\n        v-model=\"item.username\"\n        type=\"text\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"email\"\n        class=\"form-label\"\n      >電郵</label>\n      <input\n        v-model=\"item.email\"\n        type=\"email\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"password\"\n        class=\"form-label\"\n      >密碼</label>\n      <input\n        v-model=\"item.password\"\n        type=\"password\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"form-select\"\n        class=\"form-label\"\n      >身分</label>\n      <select\n        v-model=\"item.role\"\n        class=\"form-select\"\n        aria-label=\"Default select example\"\n      >\n        <option\n          disabled\n          value=\"\"\n        >\n          請選擇身份\n        </option>\n        <option\n          v-for=\"role in roles\"\n          :key=\"role\"\n          :value=\"role.roles\"\n          :selected=\"role.name === selected\"\n        >\n          {{ role.name }}\n        </option>\n      </select>\n    </div>\n    <!-- <<<<<<< HEAD -->\n    <button\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      @click=\"submit\"\n    >\n      儲存\n    </button>\n    <button\n      type=\"button\"\n      class=\"btn btn-danger\"\n      @click=\"deleteUsers(item._id)\"\n    >\n      刪除\n    </button>\n  </form>\n</template>\n\n<script>\nimport { computed, onMounted, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nexport default {\n  name: \"UsersForm\",\n  props: {\n    // eslint-disable-next-line vue/require-default-prop\n    usertype: String,\n  },\n  setup(props) {\n    let updateForm = ref(false);\n    let selected = ref(\"\");\n    const path = ref(\"\");\n    const item = ref({});\n    const router = useRoute();\n    const roles = computed(() => {\n      return [\n        {\n          roles: \"admin\",\n          name: \"管理員\",\n        },\n        {\n          roles: \"stationManager\",\n          name: \"旗長\",\n        },\n      ];\n    });\n\n    onMounted(() => {\n      console.log(router.params.uid);\n\n      // console.log(router.params.uid);\n\n      if (!(router.params.uid === \"create\")) {\n        updateForm.value = true;\n\n        fetchPage();\n      }\n      getPath();\n    });\n\n    const fetchPage = async function () {\n      const response = await fetch(`/api/users/get/${router.params.uid}`);\n      if (response.ok) {\n        let data = await response.json();\n        item.value = data.items;\n        selected.value = item.value.role;\n        console.log(data.items);\n        console.log(item.value);\n      }\n    };\n\n    const getPath = function () {\n      let elements = router.path.split(\"/\");\n      path.value = \"/\" + elements[1];\n      for (let i = 2; i < elements.length - 1; i++) {\n        path.value += \"/\" + elements[i];\n      }\n    };\n\n    // Delete function\n    const deleteUsers = async function (id) {\n      const response = await fetch(`/api/users/get/${id}/confirm/delete`, {\n        method: \"delete\",\n        body: JSON.stringify(item.value),\n      });\n      if (response.ok) {\n        alert(\"Users deleted\");\n        location.assign(\"/users\");\n      } else {\n        alert(response.statusText);\n      }\n    };\n\n    // Update function\n    const submit = async function (event) {\n      event.preventDefault();\n      console.log(updateForm.value);\n      if (!updateForm.value) {\n        const response = await fetch(`/api/users/create`, {\n          method: \"post\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(item.value),\n        });\n        if (response.ok) {\n          alert(\"建立成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      } else {\n        console.log(item.value);\n        let id = item.value._id;\n        delete item.value._id;\n        const response = await fetch(`/api/users/update/${id}`, {\n          method: \"put\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(item.value),\n        })\n        console.log(response);\n        if (response.ok) {\n          alert(\"更新成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      }\n    };\n\n    return {\n      item,\n      roles,\n      updateForm,\n      deleteUsers,\n      submit,\n    };\n  },\n};\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}