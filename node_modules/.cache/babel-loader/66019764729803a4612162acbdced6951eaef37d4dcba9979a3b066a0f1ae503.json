{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, createCommentVNode as _createCommentVNode } from \"vue\";\nvar _hoisted_1 = /*#__PURE__*/_createElementVNode(\"div\", {\n  \"class\": \"mb-3\"\n}, [/*#__PURE__*/_createElementVNode(\"legend\", null, \"用戶資料\")], -1 /* HOISTED */);\nvar _hoisted_2 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_3 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"username\",\n  \"class\": \"form-label\"\n}, \"用戶名稱\", -1 /* HOISTED */);\nvar _hoisted_4 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_5 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"email\",\n  \"class\": \"form-label\"\n}, \"電郵\", -1 /* HOISTED */);\nvar _hoisted_6 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_7 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"password\",\n  \"class\": \"form-label\"\n}, \"密碼\", -1 /* HOISTED */);\nvar _hoisted_8 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_9 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"form-select\",\n  \"class\": \"form-label\"\n}, \"身分\", -1 /* HOISTED */);\nvar _hoisted_10 = /*#__PURE__*/_createElementVNode(\"option\", {\n  disabled: \"\",\n  value: \"\"\n}, \" 請選擇身份 \", -1 /* HOISTED */);\nvar _hoisted_11 = [\"value\", \"selected\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"form\", null, [_hoisted_1, _createElementVNode(\"div\", _hoisted_2, [_hoisted_3, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.item.username = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.username]])]), _createElementVNode(\"div\", _hoisted_4, [_hoisted_5, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.item.email = $event;\n    }),\n    type: \"email\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.email]])]), _createElementVNode(\"div\", _hoisted_6, [_hoisted_7, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.item.password = $event;\n    }),\n    type: \"password\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.password]])]), _createElementVNode(\"div\", _hoisted_8, [_hoisted_9, _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = function ($event) {\n      return $setup.item.role = $event;\n    }),\n    \"class\": \"form-select\",\n    \"aria-label\": \"Default select example\"\n  }, [_hoisted_10, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.roles, function (role) {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: role,\n      value: role.roles,\n      selected: role.name === _ctx.selected\n    }, _toDisplayString(role.name), 9 /* TEXT, PROPS */, _hoisted_11);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $setup.item.role]])]), _createCommentVNode(\" <<<<<<< HEAD \"), _createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\",\n    onClick: _cache[4] || (_cache[4] = function () {\n      return $setup.submit && $setup.submit.apply($setup, arguments);\n    })\n  }, \" 儲存 \"), _createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\",\n    onClick: _cache[5] || (_cache[5] = function () {\n      return $setup.submit && $setup.submit.apply($setup, arguments);\n    })\n  }, \" 儲存 \"), _createElementVNode(\"button\", {\n    type: \"button\",\n    \"class\": \"btn btn-danger\",\n    onClick: _cache[6] || (_cache[6] = function ($event) {\n      return $setup.deleteUsers($setup.item._id);\n    })\n  }, \" 刪除 \")]);\n}","map":{"version":3,"names":["_createElementVNode","disabled","value","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","$setup","item","username","$event","type","required","_hoisted_4","_hoisted_5","email","_hoisted_6","_hoisted_7","password","_hoisted_8","_hoisted_9","role","_hoisted_10","_Fragment","_renderList","roles","key","selected","name","_ctx","_hoisted_11","_createCommentVNode","onClick","_cache","submit","apply","arguments","deleteUsers","_id"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/UsersForm.vue"],"sourcesContent":["<template>\n  <form>\n    <div class=\"mb-3\">\n      <legend>用戶資料</legend>\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"username\"\n        class=\"form-label\"\n      >用戶名稱</label>\n      <input\n        v-model=\"item.username\"\n        type=\"text\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"email\"\n        class=\"form-label\"\n      >電郵</label>\n      <input\n        v-model=\"item.email\"\n        type=\"email\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"password\"\n        class=\"form-label\"\n      >密碼</label>\n      <input\n        v-model=\"item.password\"\n        type=\"password\"\n        class=\"form-control\"\n        required=\"required\"\n      >\n    </div>\n    <div class=\"mb-3\">\n      <label\n        for=\"form-select\"\n        class=\"form-label\"\n      >身分</label>\n      <select\n        v-model=\"item.role\"\n        class=\"form-select\"\n        aria-label=\"Default select example\"\n      >\n        <option\n          disabled\n          value=\"\"\n        >\n          請選擇身份\n        </option>\n        <option\n          v-for=\"role in roles\"\n          :key=\"role\"\n          :value=\"role.roles\"\n          :selected=\"role.name === selected\"\n        >\n          {{ role.name }}\n        </option>\n      </select>\n    </div>\n    <!-- <<<<<<< HEAD -->\n    <button\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      @click=\"submit\"\n    >\n      儲存\n    </button>\n    <button\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      @click=\"submit\"\n    >\n      儲存\n    </button>\n    <button\n      type=\"button\"\n      class=\"btn btn-danger\"\n      @click=\"deleteUsers(item._id)\"\n    >\n      刪除\n    </button>\n  </form>\n</template>\n\n<script>\nimport { computed, onMounted, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nexport default {\n  name: \"UsersForm\",\n  props: {\n    // eslint-disable-next-line vue/require-default-prop\n    usertype: String,\n  },\n  setup(props) {\n    let updateForm = ref(false);\n    let selected = ref(\"\");\n    const path = ref(\"\");\n    const item = ref({});\n    const router = useRoute();\n    const roles = computed(() => {\n      return [\n        {\n          roles: \"admin\",\n          name: \"管理員\",\n        },\n        {\n          roles: \"stationManager\",\n          name: \"旗長\",\n        },\n      ];\n    });\n\n    onMounted(() => {\n      console.log(router.params.uid);\n\n      // console.log(router.params.uid);\n\n      if (!(router.params.uid === \"create\")) {\n        updateForm.value = true;\n\n        fetchPage();\n      }\n      getPath();\n    });\n\n    const fetchPage = async function () {\n      const response = await fetch(`/api/users/get/${router.params.uid}`);\n      if (response.ok) {\n        let data = await response.json();\n        item.value = data.items;\n        selected.value = item.value.role;\n        console.log(data.items);\n        console.log(item.value);\n      }\n    };\n\n    const getPath = function () {\n      let elements = router.path.split(\"/\");\n      path.value = \"/\" + elements[1];\n      for (let i = 2; i < elements.length - 1; i++) {\n        path.value += \"/\" + elements[i];\n      }\n    };\n\n    // Delete function\n    const deleteUsers = async function (id) {\n      const response = await fetch(`/api/users/get/${id}/confirm/delete`, {\n        method: \"delete\",\n        body: JSON.stringify(item.value),\n      });\n      if (response.ok) {\n        alert(\"Users deleted\");\n        location.assign(\"/users\");\n      } else {\n        alert(response.statusText);\n      }\n    };\n\n    // Update function\n    const submit = async function (event) {\n      event.preventDefault();\n      console.log(updateForm.value);\n      if (!updateForm.value) {\n        const response = await fetch(`/api/users/create`, {\n          method: \"post\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(item.value),\n        });\n        if (response.ok) {\n          alert(\"建立成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      } else {\n        console.log(item.value);\n        let id = item.value._id;\n        delete item.value._id;\n        const response = await fetch(`/api/users/update/${id}`, {\n          method: \"put\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(item.value),\n        })\n        console.log(response);\n        if (response.ok) {\n          alert(\"更新成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      }\n    };\n\n    return {\n      item,\n      roles,\n      updateForm,\n      deleteUsers,\n      submit,\n    };\n  },\n};\n</script>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}