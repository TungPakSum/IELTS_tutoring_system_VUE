{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, withModifiers as _withModifiers, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nimport _imports_0 from './../assets/icon.png';\nvar _hoisted_1 = {\n  \"class\": \"Login\"\n};\nvar _hoisted_2 = {\n  \"class\": \"container\"\n};\nvar _hoisted_3 = {\n  \"class\": \"row justify-content-center\"\n};\nvar _hoisted_4 = {\n  \"class\": \"col-sm-6\"\n};\nvar _hoisted_5 = /*#__PURE__*/_createElementVNode(\"img\", {\n  src: _imports_0,\n  \"class\": \"img-fluid\",\n  style: {\n    \"margin-bottom\": \"20px\"\n  }\n}, null, -1 /* HOISTED */);\nvar _hoisted_6 = /*#__PURE__*/_createElementVNode(\"legend\", null, \"登入\", -1 /* HOISTED */);\nvar _hoisted_7 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_8 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"exampleFormControlInput1\",\n  \"class\": \"form-label\"\n}, \"用戶： \", -1 /* HOISTED */);\nvar _hoisted_9 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_10 = /*#__PURE__*/_createElementVNode(\"label\", {\n  \"for\": \"exampleFormControlTextarea1\",\n  \"class\": \"form-label\"\n}, \"密碼： \", -1 /* HOISTED */);\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"div\", _hoisted_4, [_hoisted_5, _createElementVNode(\"form\", {\n    onSubmit: _cache[3] || (_cache[3] = _withModifiers(function () {\n      return _ctx.submit && _ctx.submit.apply(_ctx, arguments);\n    }, [\"prevent\"]))\n  }, [_hoisted_6, _createElementVNode(\"div\", _hoisted_7, [_hoisted_8, _withDirectives(_createElementVNode(\"input\", {\n    id: \"username\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.credential.username = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    placeholder: \"Username\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.credential.username]])]), _createElementVNode(\"div\", _hoisted_9, [_hoisted_10, _withDirectives(_createElementVNode(\"input\", {\n    id: \"password\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.credential.password = $event;\n    }),\n    type: \"password\",\n    \"class\": \"form-control\",\n    placeholder: \"Password\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.credential.password]])]), _createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\",\n    onClick: _cache[2] || (_cache[2] = function () {\n      return $setup.login && $setup.login.apply($setup, arguments);\n    })\n  }, \" 登入 \")], 32 /* HYDRATE_EVENTS */)])])])]);\n}","map":{"version":3,"names":["_imports_0","_createElementVNode","src","style","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","onSubmit","_cache","_withModifiers","_ctx","submit","apply","arguments","_hoisted_6","_hoisted_7","_hoisted_8","id","$setup","credential","username","$event","type","placeholder","_hoisted_9","_hoisted_10","password","onClick","login"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/Login.vue"],"sourcesContent":["<template>\n  <div class=\"Login\">\n    <div class=\"container\">\n      <div class=\"row justify-content-center\">\n        <div class=\"col-sm-6\">\n          <img src=\"./../assets/icon.png\" class=\"img-fluid\" style=\"margin-bottom: 20px;\">\n          <form @submit.prevent=\"submit\">\n            <legend>登入</legend>\n            <div class=\"mb-3\">\n              <label for=\"exampleFormControlInput1\" class=\"form-label\">用戶： </label>\n              <input id=\"username\" v-model=\"credential.username\" type=\"text\" class=\"form-control\" placeholder=\"Username\">\n            </div>\n            <div class=\"mb-3\">\n              <label for=\"exampleFormControlTextarea1\" class=\"form-label\">密碼： </label>\n              <input id=\"password\" v-model=\"credential.password\" type=\"password\" class=\"form-control\"\n                placeholder=\"Password\">\n            </div>\n            <button type=\"submit\" class=\"btn btn-primary\" @click=\"login\">\n              登入\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted } from \"vue\";\nimport JwtDecode from \"jwt-decode\";\n\nexport default {\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: 'Login',\n  setup() {\n    const credential = ref({});\n\n    const login = async function () {\n      const response = await fetch(\"/api/users/login\", {\n        method: \"post\",\n        headers: {\n          \"content-type\": \"application/json\"\n        },\n        body: JSON.stringify(credential.value)\n      });\n\n      if (response.ok) {\n        const data = await response.json();\n        let user = data;\n        try {\n          localStorage.setItem(\"token\", data.token);\n        } catch (error) {\n          console.log(error)\n        }\n\n        alert(\"Login Successfully.\")\n        //  Decode token\n        user = JwtDecode(localStorage.getItem(\"token\"));\n\n        if (user.role === 'admin') {\n          window.location.assign('/events')\n        } else if (user.role === 'stationManager') {\n          const data = await fetchStation();\n          let eid = \"\";\n          for (let i = 0; i < data.itemsWithoutPages.length; i++) {\n            eid = data.itemsWithoutPages[i].eid;\n          }\n          console.log(eid);\n          window.location.assign(`/events/${eid}/stations/`)\n        }\n      }\n      else {\n        alert(response.statusText)\n        window.location.assign('/login')\n      }\n    }\n\n    const fetchStation = async function () {\n      const response = await fetch(`/api/stations/get`, {\n        method: \"get\",\n        headers: {\n          \"x-access-token\": localStorage.getItem(\"token\"),\n          \"content-type\": \"application/json\"\n        }\n      });\n      let data = {};\n      if (response.ok) {\n        data = await response.json();\n        console.log(data);\n        return data;\n      } else {\n        alert(response.statusText)\n      }\n      return data;\n    }\n\n\n    return {\n      credential,\n      login\n    }\n  }\n}\n</script>\n"],"mappings":";OAKeA,UAA0B;;EAJlC,SAAM;AAAO;;EACX,SAAM;AAAW;;EACf,SAAM;AAA4B;;EAChC,SAAM;AAAU;8BACnBC,mBAAA,CAA+E;EAA1EC,GAA0B,EAA1BF,UAA0B;EAAC,SAAM,WAAW;EAACG,KAA4B,EAA5B;IAAA;EAAA;;8BAEhDF,mBAAA,CAAmB,gBAAX,IAAE;;EACL,SAAM;AAAM;8BACfA,mBAAA,CAAqE;EAA9D,OAAI,0BAA0B;EAAC,SAAM;GAAa,MAAI;;EAG1D,SAAM;AAAM;+BACfA,mBAAA,CAAwE;EAAjE,OAAI,6BAA6B;EAAC,SAAM;GAAa,MAAI;;;uBAZ5EG,mBAAA,CAuBM,OAvBNC,UAuBM,GAtBJJ,mBAAA,CAqBM,OArBNK,UAqBM,GApBJL,mBAAA,CAmBM,OAnBNM,UAmBM,GAlBJN,mBAAA,CAiBM,OAjBNO,UAiBM,GAhBJC,UAA+E,EAC/ER,mBAAA,CAcO;IAdAS,QAAM,EAAAC,MAAA,QAAAA,MAAA,MAAAC,cAAA;MAAA,OAAUC,IAAA,CAAAC,MAAA,IAAAD,IAAA,CAAAC,MAAA,CAAAC,KAAA,CAAAF,IAAA,EAAAG,SAAA,CAAM;IAAA;MAC3BC,UAAmB,EACnBhB,mBAAA,CAGM,OAHNiB,UAGM,GAFJC,UAAqE,E,gBACrElB,mBAAA,CAA2G;IAApGmB,EAAE,EAAC,UAAU;;aAAUC,MAAA,CAAAC,UAAU,CAACC,QAAQ,GAAAC,MAAA;IAAA;IAAEC,IAAI,EAAC,MAAM;IAAC,SAAM,cAAc;IAACC,WAAW,EAAC;iDAAlEL,MAAA,CAAAC,UAAU,CAACC,QAAQ,E,KAEnDtB,mBAAA,CAIM,OAJN0B,UAIM,GAHJC,WAAwE,E,gBACxE3B,mBAAA,CACyB;IADlBmB,EAAE,EAAC,UAAU;;aAAUC,MAAA,CAAAC,UAAU,CAACO,QAAQ,GAAAL,MAAA;IAAA;IAAEC,IAAI,EAAC,UAAU;IAAC,SAAM,cAAc;IACrFC,WAAW,EAAC;iDADgBL,MAAA,CAAAC,UAAU,CAACO,QAAQ,E,KAGnD5B,mBAAA,CAES;IAFDwB,IAAI,EAAC,QAAQ;IAAC,SAAM,iBAAiB;IAAEK,OAAK,EAAAnB,MAAA,QAAAA,MAAA;MAAA,OAAEU,MAAA,CAAAU,KAAA,IAAAV,MAAA,CAAAU,KAAA,CAAAhB,KAAA,CAAAM,MAAA,EAAAL,SAAA,CAAK;IAAA;KAAE,MAE7D,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}