{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-03597724\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = {\n  \"class\": \"row justify-content-center\"\n};\nvar _hoisted_2 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"div\", {\n    \"class\": \"mb-3\"\n  }, [/*#__PURE__*/_createElementVNode(\"legend\", null, \"參加義工\")], -1 /* HOISTED */);\n});\nvar _hoisted_3 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_4 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"username\",\n    \"class\": \"form-label\"\n  }, \"用戶名稱\", -1 /* HOISTED */);\n});\nvar _hoisted_5 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_6 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"typephone\",\n    \"class\": \"form-label\"\n  }, \"聯絡電話\", -1 /* HOISTED */);\n});\nvar _hoisted_7 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_8 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"email\"\n  }, \"聯絡電郵\", -1 /* HOISTED */);\n});\nvar _hoisted_9 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_10 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"flagLocation\",\n    \"class\": \"form-label\"\n  }, \"賣旗地點\", -1 /* HOISTED */);\n});\nvar _hoisted_11 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_12 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"form-select\",\n    \"class\": \"form-label\"\n  }, \"義工類別\", -1 /* HOISTED */);\n});\nvar _hoisted_13 = [\"disabled\"];\nvar _hoisted_14 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"option\", {\n    disabled: \"\",\n    value: \"\"\n  }, \" 請選擇 \", -1 /* HOISTED */);\n});\nvar _hoisted_15 = [\"value\"];\nvar _hoisted_16 = {\n  key: 0,\n  \"class\": \"mb-3\"\n};\nvar _hoisted_17 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"count\",\n    \"class\": \"form-label\"\n  }, \"群組人數\", -1 /* HOISTED */);\n});\nvar _hoisted_18 = [\"disabled\"];\nvar _hoisted_19 = {\n  \"class\": \"d-flex\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"form\", null, [_hoisted_2, _createElementVNode(\"div\", _hoisted_3, [_hoisted_4, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.item.username = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.username]])]), _createElementVNode(\"div\", _hoisted_5, [_hoisted_6, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.item.phoneNumber = $event;\n    }),\n    type: \"number\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.phoneNumber]])]), _createElementVNode(\"div\", _hoisted_7, [_hoisted_8, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.item.email = $event;\n    }),\n    type: \"email\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.email]])]), _createElementVNode(\"div\", _hoisted_9, [_hoisted_10, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = function ($event) {\n      return $setup.item.serviceLocation = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.serviceLocation]])]), _createElementVNode(\"div\", _hoisted_11, [_hoisted_12, _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = function ($event) {\n      return $setup.item.type = $event;\n    }),\n    \"class\": \"form-select\",\n    \"aria-label\": \"Default select example\",\n    disabled: $setup.updateForm\n  }, [_hoisted_14, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.types, function (type) {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: type,\n      value: type\n    }, _toDisplayString(type.name), 9 /* TEXT, PROPS */, _hoisted_15);\n  }), 128 /* KEYED_FRAGMENT */))], 8 /* PROPS */, _hoisted_13), [[_vModelSelect, $setup.item.type]])]), $setup.item.type && $setup.item.type.type === 'group' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_16, [_hoisted_17, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = function ($event) {\n      return $setup.item.count = $event;\n    }),\n    type: \"number\",\n    \"class\": \"form-control\",\n    required: \"required\",\n    disabled: $setup.item.type && $setup.item.type.type === 'group' && $setup.updateForm\n  }, null, 8 /* PROPS */, _hoisted_18), [[_vModelText, $setup.item.count]])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_19, [_createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\",\n    onClick: _cache[6] || (_cache[6] = function () {\n      return $setup.submit && $setup.submit.apply($setup, arguments);\n    })\n  }, \" 儲存 \"), _createElementVNode(\"button\", {\n    id: \"Dbutton\",\n    type: \"reset\",\n    \"class\": \"btn btn-danger\",\n    onClick: _cache[7] || (_cache[7] = function () {\n      return $setup.deleteItem && $setup.deleteItem.apply($setup, arguments);\n    })\n  }, \" 刪除 \")])])]);\n}","map":{"version":3,"names":["_createElementVNode","disabled","value","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","$setup","item","username","$event","type","required","_hoisted_5","_hoisted_6","phoneNumber","_hoisted_7","_hoisted_8","email","_hoisted_9","_hoisted_10","serviceLocation","_hoisted_11","_hoisted_12","updateForm","_hoisted_14","_Fragment","_renderList","types","key","name","_hoisted_15","_hoisted_16","_hoisted_17","count","_hoisted_19","onClick","_cache","submit","apply","arguments","id","deleteItem"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/VolunteerForm.vue"],"sourcesContent":["<template>\n  <div class=\"row justify-content-center\">\n    <form>\n      <div class=\"mb-3\">\n        <legend>參加義工</legend>\n      </div>\n      <div class=\"mb-3\">\n        <label\n          for=\"username\"\n          class=\"form-label\"\n        >用戶名稱</label>\n        <input\n          v-model=\"item.username\"\n          type=\"text\"\n          class=\"form-control\"\n          required=\"required\"\n        >\n      </div>\n      <div class=\"mb-3\">\n        <label\n          for=\"typephone\"\n          class=\"form-label\"\n        >聯絡電話</label>\n        <input\n          v-model=\"item.phoneNumber\"\n          type=\"number\"\n          class=\"form-control\"\n          required=\"required\"\n        >\n      </div>\n      <div class=\"mb-3\">\n        <label for=\"email\">聯絡電郵</label>\n        <input\n          v-model=\"item.email\"\n          type=\"email\"\n          class=\"form-control\"\n          required=\"required\"\n        >\n      </div>\n      <div class=\"mb-3\">\n        <label\n          for=\"flagLocation\"\n          class=\"form-label\"\n        >賣旗地點</label>\n        <input\n          v-model=\"item.serviceLocation\"\n          type=\"text\"\n          class=\"form-control\"\n          required=\"required\"\n        >\n      </div>\n      <div class=\"mb-3\">\n        <label\n          for=\"form-select\"\n          class=\"form-label\"\n        >義工類別</label>\n        <select\n          v-model=\"item.type\"\n          class=\"form-select\"\n          aria-label=\"Default select example\"\n          :disabled=\"updateForm\"\n        >\n          <option\n            disabled\n            value=\"\"\n          >\n            請選擇\n          </option>\n          <option\n            v-for=\"type in types\"\n            :key=\"type\"\n            :value=\"type\"\n          >\n            {{ type.name }}\n          </option>\n        </select>\n      </div>\n\n      <div class=\"mb-3\" v-if=\"item.type && item.type.type === 'group'\" >\n        <label for=\"count\" class=\"form-label\">群組人數</label>\n        <input v-model=\"item.count\" type=\"number\" class=\"form-control\" required=\"required\" :disabled=\"item.type && item.type.type === 'group' && updateForm\">\n      </div>\n\n      <div class=\"d-flex\">\n        <button\n          type=\"submit\"\n          class=\"btn btn-primary\"\n          @click=\"submit\"\n        >\n          儲存\n        </button>\n        <button\n          id=\"Dbutton\"\n          type=\"reset\"\n          class=\"btn btn-danger\"\n          @click=\"deleteItem\"\n        >\n          刪除\n        </button>\n      </div>\n    </form>\n  </div>\n</template>\n\n<script>\nimport {onMounted, computed, ref} from 'vue';\nimport {useRoute} from \"vue-router\";\n\nexport default {\n  name: \"VolunteerForm\",\n  setup() {\n    let updateForm = ref(false)\n    let selected = ref('')\n    let eid = ref();\n    let sid = ref();\n    let path = ref();\n    const item = ref({\n      count: ref(1)\n    });\n    const router = useRoute();\n    const types = computed(() => {\n      return [{\n        type: 'individual',\n        name: '個人'\n      }, {\n        type: 'group',\n        name: '團體'\n      }\n      ];\n    });\n\n    onMounted(() => {\n      if (!(router.params.vid == null)) {\n        updateForm.value = true;\n        fetchPage();\n      }\n      else\n      {\n        document.getElementById(\"Dbutton\").style.display = \"none\";\n      }\n      getEid();\n      getSid();\n      getPath();\n    })\n\n    const fetchPage = async function () {\n      const response = await fetch(`/api/volunteers/get/${router.params.vid}`)\n      if (response.ok) {\n        let data = await response.json();\n        item.value = data.items;\n        selected.value = item.value.role;\n        console.log(selected.value)\n      }\n    };\n\n    const getEid = function () {\n      eid.value = router.params.eid;\n    }\n\n    const getSid = function () {\n      sid.value = router.params.sid\n    }\n\n    const getPath = function () {\n      let elements = router.path.split('/')\n      path.value = '/' + elements[1];\n      for (let i = 2; i < elements.length - 1; i++) {\n        path.value += '/' + elements[i];\n      }\n    }\n\n    const submit = async function (event) {\n      event.preventDefault();\n      if (!updateForm.value) {\n        item.value.eid = eid.value;\n        item.value.sid = sid.value;\n        \n        const response1 = await fetch('/api/volunteers/create', {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(item.value)\n        });\n         \n        const vid = await response1.json(); // extract Object ID from response 1\n        const response2 = await fetch('/api/flagbags/create', {\n        method: 'post',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          name: item.value.username,\n          count: item.value.count,\n          eid: item.value.eid,\n          sid: item.value.sid,\n          vid: vid // add Object ID to response 2\n        })\n      });\n\n        if (response1.ok && response2.ok) {\n          alert(\"建立成功\")\n\n          getEid();\n          window.location.assign(path.value)\n        } else {\n          alert(\"create action fail\")\n        }\n      } else {\n        let id = item.value._id;\n        delete item.value._id;\n        const response = await fetch(`/api/volunteers/update/${id}`, {\n          method: 'put',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(item.value)\n        });\n        if (response.ok) {\n          alert(\"更新成功\");\n          window.location.assign(path.value)\n        } else {\n          alert(response.statusText)\n        }\n      }\n    };\n\n    const deleteItem = async function (event) {\n      event.preventDefault()\n      let id = item.value._id;\n      delete item.value._id;\n      if (confirm(\"確定刪除?\")) {\n        const response1 = await fetch(`/api/volunteers/delete/${id}`, {\n          method: \"delete\",\n          body: JSON.stringify(item.value),\n        });\n        if (response1.ok && response2) {\n          alert(\"項目已刪除\");\n          location.assign(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      }\n    };\n    return {\n      item,\n      types,\n      updateForm,\n      selected,\n      submit,\n      deleteItem\n    };\n  },\n};\n</script>\n\n<style scoped>\n.btn {\n  margin-right: 10px;\n}\n</style>\n"],"mappings":";;;;;;EACO,SAAM;AAA4B;;sBAEnCA,mBAAA,CAEM;IAFD,SAAM;EAAM,I,aACfA,mBAAA,CAAqB,gBAAb,MAAI,E;;;EAET,SAAM;AAAM;;sBACfA,mBAAA,CAGa;IAFX,OAAI,UAAU;IACd,SAAM;KACP,MAAI;AAAA;;EAQF,SAAM;AAAM;;sBACfA,mBAAA,CAGa;IAFX,OAAI,WAAW;IACf,SAAM;KACP,MAAI;AAAA;;EAQF,SAAM;AAAM;;sBACfA,mBAAA,CAA+B;IAAxB,OAAI;EAAO,GAAC,MAAI;AAAA;;EAQpB,SAAM;AAAM;;sBACfA,mBAAA,CAGa;IAFX,OAAI,cAAc;IAClB,SAAM;KACP,MAAI;AAAA;;EAQF,SAAM;AAAM;;sBACfA,mBAAA,CAGa;IAFX,OAAI,aAAa;IACjB,SAAM;KACP,MAAI;AAAA;;;sBAOHA,mBAAA,CAKS;IAJPC,QAAQ,EAAR,EAAQ;IACRC,KAAK,EAAC;KACP,OAED;AAAA;;;;EAWC,SAAM;;;sBACTF,mBAAA,CAAkD;IAA3C,OAAI,OAAO;IAAC,SAAM;KAAa,MAAI;AAAA;;;EAIvC,SAAM;AAAQ;;uBAlFvBG,mBAAA,CAoGM,OApGNC,UAoGM,GAnGJJ,mBAAA,CAkGO,eAjGLK,UAEM,EACNL,mBAAA,CAWM,OAXNM,UAWM,GAVJC,UAGa,E,gBACbP,mBAAA,CAKC;;aAJUQ,MAAA,CAAAC,IAAI,CAACC,QAAQ,GAAAC,MAAA;IAAA;IACtBC,IAAI,EAAC,MAAM;IACX,SAAM,cAAc;IACpBC,QAAQ,EAAC;iDAHAL,MAAA,CAAAC,IAAI,CAACC,QAAQ,E,KAM1BV,mBAAA,CAWM,OAXNc,UAWM,GAVJC,UAGa,E,gBACbf,mBAAA,CAKC;;aAJUQ,MAAA,CAAAC,IAAI,CAACO,WAAW,GAAAL,MAAA;IAAA;IACzBC,IAAI,EAAC,QAAQ;IACb,SAAM,cAAc;IACpBC,QAAQ,EAAC;iDAHAL,MAAA,CAAAC,IAAI,CAACO,WAAW,E,KAM7BhB,mBAAA,CAQM,OARNiB,UAQM,GAPJC,UAA+B,E,gBAC/BlB,mBAAA,CAKC;;aAJUQ,MAAA,CAAAC,IAAI,CAACU,KAAK,GAAAR,MAAA;IAAA;IACnBC,IAAI,EAAC,OAAO;IACZ,SAAM,cAAc;IACpBC,QAAQ,EAAC;iDAHAL,MAAA,CAAAC,IAAI,CAACU,KAAK,E,KAMvBnB,mBAAA,CAWM,OAXNoB,UAWM,GAVJC,WAGa,E,gBACbrB,mBAAA,CAKC;;aAJUQ,MAAA,CAAAC,IAAI,CAACa,eAAe,GAAAX,MAAA;IAAA;IAC7BC,IAAI,EAAC,MAAM;IACX,SAAM,cAAc;IACpBC,QAAQ,EAAC;iDAHAL,MAAA,CAAAC,IAAI,CAACa,eAAe,E,KAMjCtB,mBAAA,CAyBM,OAzBNuB,WAyBM,GAxBJC,WAGa,E,gBACbxB,mBAAA,CAmBS;;aAlBEQ,MAAA,CAAAC,IAAI,CAACG,IAAI,GAAAD,MAAA;IAAA;IAClB,SAAM,aAAa;IACnB,YAAU,EAAC,wBAAwB;IAClCV,QAAQ,EAAEO,MAAA,CAAAiB;MAEXC,WAKS,G,kBACTvB,mBAAA,CAMSwB,SAAA,QAAAC,WAAA,CALQpB,MAAA,CAAAqB,KAAK,YAAbjB,IAAI;yBADbT,mBAAA,CAMS;MAJN2B,GAAG,EAAElB,IAAI;MACTV,KAAK,EAAEU;wBAELA,IAAI,CAACmB,IAAI,wBAAAC,WAAA;iFAhBLxB,MAAA,CAAAC,IAAI,CAACG,IAAI,E,KAqBEJ,MAAA,CAAAC,IAAI,CAACG,IAAI,IAAIJ,MAAA,CAAAC,IAAI,CAACG,IAAI,CAACA,IAAI,gB,cAAnDT,mBAAA,CAGM,OAHN8B,WAGM,GAFJC,WAAkD,E,gBAClDlC,mBAAA,CAAqJ;;aAArIQ,MAAA,CAAAC,IAAI,CAAC0B,KAAK,GAAAxB,MAAA;IAAA;IAAEC,IAAI,EAAC,QAAQ;IAAC,SAAM,cAAc;IAACC,QAAQ,EAAC,UAAU;IAAEZ,QAAQ,EAAEO,MAAA,CAAAC,IAAI,CAACG,IAAI,IAAIJ,MAAA,CAAAC,IAAI,CAACG,IAAI,CAACA,IAAI,gBAAgBJ,MAAA,CAAAiB;uDAAzHjB,MAAA,CAAAC,IAAI,CAAC0B,KAAK,E,0CAG5BnC,mBAAA,CAgBM,OAhBNoC,WAgBM,GAfJpC,mBAAA,CAMS;IALPY,IAAI,EAAC,QAAQ;IACb,SAAM,iBAAiB;IACtByB,OAAK,EAAAC,MAAA,QAAAA,MAAA;MAAA,OAAE9B,MAAA,CAAA+B,MAAA,IAAA/B,MAAA,CAAA+B,MAAA,CAAAC,KAAA,CAAAhC,MAAA,EAAAiC,SAAA,CAAM;IAAA;KACf,MAED,GACAzC,mBAAA,CAOS;IANP0C,EAAE,EAAC,SAAS;IACZ9B,IAAI,EAAC,OAAO;IACZ,SAAM,gBAAgB;IACrByB,OAAK,EAAAC,MAAA,QAAAA,MAAA;MAAA,OAAE9B,MAAA,CAAAmC,UAAA,IAAAnC,MAAA,CAAAmC,UAAA,CAAAH,KAAA,CAAAhC,MAAA,EAAAiC,SAAA,CAAU;IAAA;KACnB,MAED,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}