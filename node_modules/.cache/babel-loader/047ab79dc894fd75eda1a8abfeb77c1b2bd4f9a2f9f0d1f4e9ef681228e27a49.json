{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-0d29aaeb\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"div\", {\n    \"class\": \"mb-3\"\n  }, [/*#__PURE__*/_createElementVNode(\"legend\", null, \"旗袋資料\")], -1 /* HOISTED */);\n});\nvar _hoisted_2 = {\n  id: \"name\",\n  \"class\": \"mb-3\"\n};\nvar _hoisted_3 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"name\",\n    \"class\": \"form-label\"\n  }, \"旗袋持有人名稱\", -1 /* HOISTED */);\n});\nvar _hoisted_4 = {\n  \"class\": \"mb-3\"\n};\nvar _hoisted_5 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"district\",\n    \"class\": \"form-label\"\n  }, \"旗袋狀態\", -1 /* HOISTED */);\n});\nvar _hoisted_6 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"option\", {\n    disabled: \"\",\n    value: \"\"\n  }, \" 請選擇 \", -1 /* HOISTED */);\n});\nvar _hoisted_7 = [\"value\"];\nvar _hoisted_8 = {\n  \"class\": \"mb-3 =d-flex\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"form\", null, [_hoisted_1, _createElementVNode(\"div\", _hoisted_2, [_hoisted_3, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.item.name = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.name]])]), _createElementVNode(\"div\", _hoisted_4, [_hoisted_5, _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.item.flagStatus = $event;\n    }),\n    \"class\": \"form-select\",\n    \"aria-label\": \"Default select example\"\n  }, [_hoisted_6, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.flagStatus, function (status) {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: status,\n      value: status\n    }, _toDisplayString(status.name), 9 /* TEXT, PROPS */, _hoisted_7);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $setup.item.flagStatus]])]), _createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\",\n    onClick: _cache[2] || (_cache[2] = function () {\n      return $setup.submit && $setup.submit.apply($setup, arguments);\n    })\n  }, \" 儲存 \"), _createElementVNode(\"button\", {\n    id: \"Dbutton\",\n    \"class\": \"btn btn-danger\",\n    onClick: _cache[3] || (_cache[3] = function () {\n      return $setup.deleteItem && $setup.deleteItem.apply($setup, arguments);\n    })\n  }, \" 刪除 \")])]);\n}","map":{"version":3,"names":["_createElementVNode","id","disabled","value","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","$setup","item","name","$event","type","required","_hoisted_4","_hoisted_5","flagStatus","_hoisted_6","_Fragment","_renderList","status","key","_hoisted_7","_hoisted_8","onClick","_cache","submit","apply","arguments","deleteItem"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/FlagbagsForm.vue"],"sourcesContent":["<template>\n  <form>\n    <div class=\"mb-3\">\n      <legend>旗袋資料</legend>\n    </div>\n    <div id=\"name\" class=\"mb-3\">\n      <label for=\"name\" class=\"form-label\">旗袋持有人名稱</label>\n      <input v-model=\"item.name\" type=\"text\" class=\"form-control\" required=\"required\">\n    </div>\n    <div class=\"mb-3\">\n      <label for=\"district\" class=\"form-label\">旗袋狀態</label>\n      <select v-model=\"item.flagStatus\" class=\"form-select\" aria-label=\"Default select example\">\n        <option disabled value=\"\">\n          請選擇\n        </option>\n        <option v-for=\"status in flagStatus\" :key=\"status\" :value=\"status\">\n          {{ status.name }}\n        </option>\n      </select>\n    </div>\n\n    <div class=\"mb-3 =d-flex\">\n      <button type=\"submit\" class=\"btn btn-primary\" @click=\"submit\">\n        儲存\n      </button>\n      <button id=\"Dbutton\" class=\"btn btn-danger\" @click=\"deleteItem\">\n        刪除\n      </button>\n    </div>\n  </form>\n</template>\n\n<script>\nimport { onMounted, computed, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\n\nexport default {\n  name: \"StationsForm\",\n  setup() {\n    let updateForm = ref(false)\n    let selected = ref('')\n    let path = ref();\n    const fid = ref();\n    const vid = ref();\n    const sid = ref();\n    const eid = ref();\n    const item = ref({});\n    const router = useRoute();\n    const flagStatus = computed(() => {\n      return [{\n        status: 'issued',\n        name: '已發放'\n      }, {\n        status: 'received',\n        name: '已收取'\n      }, {\n        status: 'not-issued',\n        name: '未發放'\n      }];\n    });\n\n\n    onMounted(() => {\n      if (!(router.params.fid == null)) {\n        updateForm.value = true\n        fetchPage();\n      } else {\n        document.getElementById(\"Dbutton\").style.display = \"none\";\n        checkUserToken();\n      }\n      getFid();\n      getVid();\n      getEid();\n      getSid();\n      getPath();\n    })\n\n    const checkUserToken = async function () {\n      const response = await fetch(`/api/users/check`, {\n        headers: {\n          \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n        },\n      });\n      if (response.status === 401) {\n        alert(response.statusText);\n        location.assign(\"/login\");\n      } else if (response.status === 403) {\n        alert(response.statusText);\n        history.back()\n      }\n    }\n\n    const fetchPage = async function () {\n      const response = await fetch(`/api/flagbags/get/${router.params.fid}`);\n      if (response.ok) {\n        let data = await response.json();\n        item.value = data.items;\n        selected.value = item.value.district\n      }\n    };\n\n    const getFid = function () {\n      fid.value = router.params.fid\n    }\n\n    const getVid = function () {\n      vid.value = router.params.vid;\n    };\n\n    const getEid = function () {\n      eid.value = router.params.eid;\n    };\n\n    const getSid = function () {\n      sid.value = router.params.sid;\n    };\n\n    const verifyNull = function () {\n      if (this.item.name == null) {\n        return false;\n      }\n      return true\n    }\n\n    const getPath = function () {\n      let elements = router.path.split('/')\n      path.value = '/' + elements[1];\n      for (let i = 2; i < elements.length - 1; i++) {\n        path.value += '/' + elements[i];\n      }\n    }\n\n    const submit = async function (event) {\n      event.preventDefault();\n\n\n      if (!updateForm.value) {\n        item.value.fid = fid.value;\n        item.value.eid = eid.value;\n        item.value.sid = sid.value;\n        item.value.vid = vid.value;\n\n        if (!(verifyNull)) {\n          alert(\"please fill in all information\")\n        }\n        else {\n          console.log(eid)\n          const response1 = await fetch(`/api/flagbags/create`, {\n            method: \"post\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n            },\n            body: JSON.stringify(\n              item.value,\n            ),\n          });\n\n          const response2 = await fetch(`/api/volunteers/increase/${vid.value}`, {\n            method: \"put\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n            }\n          });\n\n          if (response1.ok && response2.ok) {\n            alert(\"建立成功\");\n            //getEid();\n            window.location.replace(path.value);\n          } else {\n            alert(\"create action fail\");\n          }\n        }\n      } else {\n        if (!(verifyNull)) {\n          alert(\"please fill in all information\")\n        }\n        else {\n          const id = item.value._id\n          delete item.value._id;\n          const response = await fetch(`/api/flagbags/update/${id}`, {\n            method: \"put\",\n            headers: {\n              \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify(item.value),\n          });\n\n          if (response.ok) {\n            alert(\"編輯成功\");\n            //getEid();\n            window.location.replace(path.value)\n          } else {\n            alert(response.statusText);\n          }\n        }\n      }\n    };\n\n    const deleteItem = async function (event) {\n      event.preventDefault()\n      let id = item.value._id;\n      if (confirm(\"確定刪除?\")) {\n\n        const response1 = await fetch(`/api/flagbags/delete/${id}`, {\n          method: \"delete\",\n          body: JSON.stringify(item.value),\n          headers: {\n            \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n          },\n        });\n\n        const response2 = await fetch(`/api/volunteers/decrease/${vid.value}`, {\n          method: \"put\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n          }\n        });\n        console.log('line 158')\n        if (response1.ok && response2.ok) {\n          alert(\"項目已刪除\");\n          location.assign(path.value);\n        } else {\n          alert(\"delete action fail\");\n        }\n      }\n    };\n\n    return {\n      item,\n      flagStatus,\n      updateForm,\n      selected,\n      submit,\n      deleteItem,\n      verifyNull\n\n    };\n  },\n};\n</script>\n<style scoped>\n.btn {\n  margin-right: 10px;\n}\n</style>\n"],"mappings":";;;;;;sBAEIA,mBAAA,CAEM;IAFD,SAAM;EAAM,I,aACfA,mBAAA,CAAqB,gBAAb,MAAI,E;;;EAETC,EAAE,EAAC,MAAM;EAAC,SAAM;;;sBACnBD,mBAAA,CAAoD;IAA7C,OAAI,MAAM;IAAC,SAAM;KAAa,SAAO;AAAA;;EAGzC,SAAM;AAAM;;sBACfA,mBAAA,CAAqD;IAA9C,OAAI,UAAU;IAAC,SAAM;KAAa,MAAI;AAAA;;sBAE3CA,mBAAA,CAES;IAFDE,QAAQ,EAAR,EAAQ;IAACC,KAAK,EAAC;KAAG,OAE1B;AAAA;;;EAOC,SAAM;AAAc;;uBApB3BC,mBAAA,CA4BO,eA3BLC,UAEM,EACNL,mBAAA,CAGM,OAHNM,UAGM,GAFJC,UAAoD,E,gBACpDP,mBAAA,CAAgF;;aAAhEQ,MAAA,CAAAC,IAAI,CAACC,IAAI,GAAAC,MAAA;IAAA;IAAEC,IAAI,EAAC,MAAM;IAAC,SAAM,cAAc;IAACC,QAAQ,EAAC;iDAArDL,MAAA,CAAAC,IAAI,CAACC,IAAI,E,KAE3BV,mBAAA,CAUM,OAVNc,UAUM,GATJC,UAAqD,E,gBACrDf,mBAAA,CAOS;;aAPQQ,MAAA,CAAAC,IAAI,CAACO,UAAU,GAAAL,MAAA;IAAA;IAAE,SAAM,aAAa;IAAC,YAAU,EAAC;MAC/DM,UAES,G,kBACTb,mBAAA,CAESc,SAAA,QAAAC,WAAA,CAFgBX,MAAA,CAAAQ,UAAU,YAApBI,MAAM;yBAArBhB,mBAAA,CAES;MAF6BiB,GAAG,EAAED,MAAM;MAAGjB,KAAK,EAAEiB;wBACtDA,MAAM,CAACV,IAAI,wBAAAY,UAAA;2EALDd,MAAA,CAAAC,IAAI,CAACO,UAAU,E,KAUlChB,mBAAA,CAOM,OAPNuB,UAOM,GANJvB,mBAAA,CAES;IAFDY,IAAI,EAAC,QAAQ;IAAC,SAAM,iBAAiB;IAAEY,OAAK,EAAAC,MAAA,QAAAA,MAAA;MAAA,OAAEjB,MAAA,CAAAkB,MAAA,IAAAlB,MAAA,CAAAkB,MAAA,CAAAC,KAAA,CAAAnB,MAAA,EAAAoB,SAAA,CAAM;IAAA;KAAE,MAE9D,GACA5B,mBAAA,CAES;IAFDC,EAAE,EAAC,SAAS;IAAC,SAAM,gBAAgB;IAAEuB,OAAK,EAAAC,MAAA,QAAAA,MAAA;MAAA,OAAEjB,MAAA,CAAAqB,UAAA,IAAArB,MAAA,CAAAqB,UAAA,CAAAF,KAAA,CAAAnB,MAAA,EAAAoB,SAAA,CAAU;IAAA;KAAE,MAEhE,E"},"metadata":{},"sourceType":"module","externalDependencies":[]}