{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, vModelSelect as _vModelSelect, withModifiers as _withModifiers, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-e6a52628\"), n = n(), _popScopeId(), n;\n};\nvar _hoisted_1 = {\n  \"class\": \"container-fluid px-1 py-5 mx-auto background\"\n};\nvar _hoisted_2 = {\n  \"class\": \"row d-flex justify-content-center\"\n};\nvar _hoisted_3 = {\n  \"class\": \"col-xl-7 col-lg-8 col-md-9 col-11 text-center\"\n};\nvar _hoisted_4 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"h3\", null, \"用戶資料\", -1 /* HOISTED */);\n});\nvar _hoisted_5 = {\n  \"class\": \"card\"\n};\nvar _hoisted_6 = {\n  \"class\": \"row justify-content-between text-left\"\n};\nvar _hoisted_7 = {\n  \"class\": \"form-group col-sm-6 flex-column d-flex\"\n};\nvar _hoisted_8 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"username\",\n    \"class\": \"form-label\"\n  }, \"用戶名稱\", -1 /* HOISTED */);\n});\nvar _hoisted_9 = {\n  \"class\": \"form-group col-sm-6 flex-column d-flex\"\n};\nvar _hoisted_10 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"email\",\n    \"class\": \"form-label\"\n  }, \"電郵\", -1 /* HOISTED */);\n});\nvar _hoisted_11 = {\n  \"class\": \"row justify-content-between text-left\"\n};\nvar _hoisted_12 = {\n  \"class\": \"form-group col-sm-6 flex-column d-flex\"\n};\nvar _hoisted_13 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"password\",\n    \"class\": \"form-label\"\n  }, \"密碼\", -1 /* HOISTED */);\n});\nvar _hoisted_14 = {\n  \"class\": \"form-group col-sm-6 flex-column d-flex\"\n};\nvar _hoisted_15 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"label\", {\n    \"for\": \"form-select\",\n    \"class\": \"form-label\"\n  }, \"身分\", -1 /* HOISTED */);\n});\nvar _hoisted_16 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"option\", {\n    disabled: \"\",\n    value: \"\"\n  }, \" 請選擇身份 \", -1 /* HOISTED */);\n});\nvar _hoisted_17 = [\"value\", \"selected\"];\nvar _hoisted_18 = {\n  \"class\": \"row justify-content-end\"\n};\nvar _hoisted_19 = {\n  \"class\": \"form-group col-sm-6\"\n};\nvar _hoisted_20 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"btn btn-primary\"\n  }, \" 儲存 \", -1 /* HOISTED */);\n});\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_hoisted_4, _createCommentVNode(\" </div> \"), _createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"form\", {\n    \"class\": \"form-card\",\n    onSubmit: _cache[5] || (_cache[5] = _withModifiers(function () {\n      return $setup.submit && $setup.submit.apply($setup, arguments);\n    }, [\"prevent\"]))\n  }, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_hoisted_8, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.item.username = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.username]])]), _createElementVNode(\"div\", _hoisted_9, [_hoisted_10, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.item.email = $event;\n    }),\n    type: \"email\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.email]])])]), _createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"div\", _hoisted_12, [_hoisted_13, _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.item.password = $event;\n    }),\n    type: \"password\",\n    \"class\": \"form-control\",\n    required: \"required\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.item.password]])]), _createElementVNode(\"div\", _hoisted_14, [_hoisted_15, _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = function ($event) {\n      return $setup.item.role = $event;\n    }),\n    \"class\": \"form-select\",\n    \"aria-label\": \"Default select example\"\n  }, [_hoisted_16, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.roles, function (role) {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: role,\n      value: role.roles,\n      selected: role.name === _ctx.selected\n    }, _toDisplayString(role.name), 9 /* TEXT, PROPS */, _hoisted_17);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $setup.item.role]])])]), _createCommentVNode(\" <<<<<<< HEAD \"), _createElementVNode(\"div\", _hoisted_18, [_createElementVNode(\"div\", _hoisted_19, [_hoisted_20, _createElementVNode(\"button\", {\n    type: \"button\",\n    \"class\": \"btn btn-danger\",\n    onClick: _cache[4] || (_cache[4] = function ($event) {\n      return $setup.deleteUsers($setup.item._id);\n    })\n  }, \" 刪除 \")])])], 32 /* HYDRATE_EVENTS */)])])])]);\n}","map":{"version":3,"names":["_createElementVNode","disabled","value","type","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_createCommentVNode","_hoisted_5","onSubmit","_cache","_withModifiers","$setup","submit","apply","arguments","_hoisted_6","_hoisted_7","_hoisted_8","item","username","$event","required","_hoisted_9","_hoisted_10","email","_hoisted_11","_hoisted_12","_hoisted_13","password","_hoisted_14","_hoisted_15","role","_hoisted_16","_Fragment","_renderList","roles","key","selected","name","_ctx","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","onClick","deleteUsers","_id"],"sources":["/Users/paksumtung/Documents/COMP4117/comp4117-spring2023-frontend-group-d/src/components/UsersForm.vue"],"sourcesContent":["<template>\n  <div class=\"container-fluid px-1 py-5 mx-auto background\">\n    <div class=\"row d-flex justify-content-center\">\n      <div class=\"col-xl-7 col-lg-8 col-md-9 col-11 text-center\">\n        <h3>用戶資料</h3>\n        <!-- </div> -->\n        <div class=\"card\">\n          <form class=\"form-card\" @submit.prevent=\"submit\">\n            <div class=\"row justify-content-between text-left\">\n              <div class=\"form-group col-sm-6 flex-column d-flex\">\n                <label for=\"username\" class=\"form-label\">用戶名稱</label>\n                <input v-model=\"item.username\" type=\"text\" class=\"form-control\" required=\"required\">\n              </div>\n              <div class=\"form-group col-sm-6 flex-column d-flex\">\n                <label for=\"email\" class=\"form-label\">電郵</label>\n                <input v-model=\"item.email\" type=\"email\" class=\"form-control\" required=\"required\">\n              </div>\n            </div>\n            <div class=\"row justify-content-between text-left\">\n              <div class=\"form-group col-sm-6 flex-column d-flex\">\n                <label for=\"password\" class=\"form-label\">密碼</label>\n                <input v-model=\"item.password\" type=\"password\" class=\"form-control\" required=\"required\">\n              </div>\n              <div class=\"form-group col-sm-6 flex-column d-flex\">\n                <label for=\"form-select\" class=\"form-label\">身分</label>\n                <select v-model=\"item.role\" class=\"form-select\" aria-label=\"Default select example\">\n                  <option disabled value=\"\">\n                    請選擇身份\n                  </option>\n                  <option v-for=\"role in roles\" :key=\"role\" :value=\"role.roles\" :selected=\"role.name === selected\">\n                    {{ role.name }}\n                  </option>\n                </select>\n              </div>\n            </div>\n            <!-- <<<<<<< HEAD -->\n\n            <div class=\"row justify-content-end\">\n              <div class=\"form-group col-sm-6\">\n                <button type=\"submit\" class=\"btn btn-primary\">\n                  儲存\n                </button>\n                <button type=\"button\" class=\"btn btn-danger\" @click=\"deleteUsers(item._id)\">\n                  刪除\n                </button>\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { computed, onMounted, ref } from \"vue\";\nimport { useRoute } from \"vue-router\";\nimport decode from \"jwt-decode\";\n\nexport default {\n  name: \"UsersForm\",\n  setup() {\n    let updateForm = ref(false);\n    let selected = ref(\"\");\n    const path = ref(\"\");\n    const item = ref({});\n    const router = useRoute();\n\n    const roles = computed(() => {\n      return [\n        {\n          roles: \"admin\",\n          name: \"管理員\",\n        },\n        {\n          roles: \"stationManager\",\n          name: \"旗長\",\n        },\n      ];\n    });\n\n    onMounted(() => {\n      if (!(router.params.uid === \"create\")) {\n        updateForm.value = true;\n        fetchPage();\n      }\n      checkUserToken();\n      checkUserType();\n      getPath();\n    });\n\n    const checkUserToken = async function () {\n      const response = await fetch(`/api/users/check`, {\n        headers: {\n          \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n        },\n      });\n      if (response.status === 401) {\n        alert(response.statusText);\n        location.assign(\"/login\");\n      } else if (response.status === 403) {\n        alert(response.statusText);\n        history.back()\n      }\n    }\n\n    const checkUserType = function() {\n      const token = decode(localStorage.getItem(\"token\"))\n      if (token.role !== \"admin\") {\n        alert(\"權限不足\");\n        history.back()\n      }\n    }\n\n    const fetchPage = async function () {\n      const response = await fetch(`/api/users/get/${router.params.uid}`, {\n        headers: {\n          \"x-access-token\": `${localStorage.getItem(\"token\")}`,\n        }\n      });\n      if (response.ok) {\n        let data = await response.json();\n        delete data.items.password;\n        item.value = data.items;\n        selected.value = item.value.role;\n        console.log(data.items);\n        console.log(item.value);\n      } else {\n        if (response.status === 401) {\n          alert(response.statusText);\n          location.assign(\"/login\");\n        } else if (response.status === 403) {\n          alert(response.statusText);\n          history.back()\n        } else\n          alert(response.statusText);\n      }\n    };\n\n    const getPath = function () {\n      let elements = router.path.split(\"/\");\n      path.value = \"/\" + elements[1];\n      for (let i = 2; i < elements.length - 1; i++) {\n        path.value += \"/\" + elements[i];\n      }\n    };\n\n    // Delete function\n    const deleteUsers = async function (id) {\n      const response = await fetch(`/api/users/get/${id}/confirm/delete`, {\n        method: \"delete\",\n        body: JSON.stringify(item.value),\n        headers: {\n          \"x-access-token\": `${localStorage.getItem(\"token\")}`\n        }\n      });\n      if (response.ok) {\n        alert(\"Users deleted\");\n        location.assign(\"/users\");\n      } else {\n        alert(response.statusText);\n      }\n    };\n\n    // Update function\n    const submit = async function (event) {\n      event.preventDefault();\n      console.log(updateForm.value);\n      if (!updateForm.value) {\n        const response = await fetch(`/api/users/create`, {\n          method: \"post\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"x-access-token\": `${localStorage.getItem(\"token\")}`\n          },\n          body: JSON.stringify(item.value),\n        });\n        if (response.ok) {\n          alert(\"建立成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      } else {\n        console.log(item.value);\n        let id = item.value._id;\n        delete item.value._id;\n        const response = await fetch(`/api/users/update/${id}`, {\n          method: \"put\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n          body: JSON.stringify(item.value),\n        });\n        console.log(response);\n        if (response.ok) {\n          alert(\"更新成功\");\n          window.location.replace(path.value);\n        } else {\n          alert(response.statusText);\n        }\n      }\n    };\n\n    return {\n      item,\n      roles,\n      updateForm,\n      deleteUsers,\n      submit,\n    };\n  },\n};\n</script>\n<style scoped>\n.btn {\n  margin-right: 10px;\n}\n\n/* .background {\n  background-image: url(\"https://i.imgur.com/GMmCQHC.png\");\n} */\n\n/* Test */\nbody {\n  color: #000;\n  overflow-x: hidden;\n  height: 100%;\n  /* background-image: url(\"https://i.imgur.com/GMmCQHC.png\"); */\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n}\n\n.card {\n  padding: 30px 40px;\n  margin-top: 60px;\n  margin-bottom: 60px;\n  border: none !important;\n  box-shadow: 0 6px 12px 0 rgba(0, 0, 0, 0.2);\n}\n\n.blue-text {\n  color: #00bcd4;\n}\n\n.form-control-label {\n  margin-bottom: 0;\n}\n\ninput,\nselect,\ntextarea,\nbutton {\n  padding: 8px 15px;\n  border-radius: 5px !important;\n  margin: 5px 0px;\n  box-sizing: border-box;\n  border: 1px solid #ccc;\n  font-size: 18px !important;\n  font-weight: 300;\n}\n\ninput:focus,\ntextarea:focus {\n  -moz-box-shadow: none !important;\n  -webkit-box-shadow: none !important;\n  box-shadow: none !important;\n  border: 1px solid #00bcd4;\n  outline-width: 0;\n  font-weight: 400;\n}\n\n.btn-block {\n  text-transform: uppercase;\n  font-size: 15px !important;\n  font-weight: 400;\n  height: 43px;\n  cursor: pointer;\n}\n\n.btn-block:hover {\n  color: #fff !important;\n}\n\nbutton:focus {\n  -moz-box-shadow: none !important;\n  -webkit-box-shadow: none !important;\n  box-shadow: none !important;\n  outline-width: 0;\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}